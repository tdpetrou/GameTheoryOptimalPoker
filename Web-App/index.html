<!DOCTYPE html>
<html>
   <head prefix="og: http://ogp.me/ns#">
      <meta property="og:type" content="website" />
      <meta property="og:title" content="Heads-Up Limit Texas Hold'em" />
      <meta property="og:site_name" content="Game Theory Optimal Poker"/>
      <meta property="og:url" content="http://www.gametheoryoptimalpoker.com" />
      <meta property="og:image" content="http://www.gametheoryoptimalpoker.com/images/preview.png"/>
      <meta property="og:image:type" content="image/png">
      <meta property="og:description" content="Play heads-up limit Texas hold'em against an A.I designed to play game theory optimal poker. Don't forget to check out the stats page to see how you rank against other competitors." />
      <meta property="fb:app_id" content="706390152732478" />
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <!-- Bootstrap -->
      <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css">
      <link type="text/css" rel="stylesheet" href="stylesheet.css?version=1"/>
      <!--version=1 prevents caching -->
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
      <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
      <title>Limit Heads-Up Poker</title>
      <!-- twitter stuff -->
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
      <!-- google analytics -->
      <script>
         (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
         (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
         m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
         })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
         
         ga('create', 'UA-56624456-1', 'auto');
         ga('send', 'pageview');
      </script>
   </head>
   <body>
      <div id="fb-root"></div>
      <!-- navigation header bar starts here -->
      <nav class="navbar navbar-default"  role="navigation">
         <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
               <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
               <span class="sr-only">Toggle navigation</span>
               <span class="icon-bar"></span>
               <span class="icon-bar"></span>
               <span class="icon-bar"></span>
               </button>
               <a class="navbar-brand" href="index.html" target="_blank">GTO Poker</a>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
               <ul class="nav navbar-nav">
                  <li ><a href="about.html" target = "_blank">About</a></li>
                  <li><a href="stat_page.html" target = "_blank">Stat Page</a></li>
                  <li><a href="fullAccess.html" target = "_blank">Full Access to Computer Cards</a></li>
                  <li><a href="http://www.dunderdata.com" target = "_blank">Learn Data Science</a></li>
               </ul>
               <ul class="nav navbar-nav navbar-right">
                  <li>
                     <div class="fb-like" data-send="true" data-width="120" show-faces="false" data-layout ="button_count" data-href="https://www.facebook.com/GameTheoryOptimalPoker" ></div>
                  </li>
                  <li>
                     <a href="https://github.com/tdpetrou/GameTheoryOptimalPoker" class="logo" id="in-logo" target = "_blank">
                     <img id = "github_icon" style = "height:32px" src="images/github_icon.png"/>
                     </a>
                  </li>
               </ul>
            </div>
            <!-- /.navbar-collapse -->
         </div>
         <!-- /.container-fluid -->
      </nav>
      <!-- end of navigation bar -->
      <div id= "bodyWrapper">
         <p id="header">Limit Hold'em Heads-Up Poker</p>
         <div class = "veryTinyDiv"> </div>
         <!--<p id = "perc" style ="text-align:center";>Percentile is "</p>-->
         <div class = "bigDiv">
            <div class = "rightBet" >
               <p id = "compBet">Computer Bet: 0</p>
            </div>
            <div class ="compCard">
               <div class = "crop">
                  <img id = "card8" alt = "compcard" src = "images/card_back.png"/>
               </div>
               <div class = "crop">
                  <img id = "card9" alt = "compcard" src = "images/card_back.png"/>
               </div>
               <div class = "divButton">
                  <img id = "imgButtonComp" alt = "button" src = "images/button.jpg" />
               </div>
            </div>
            <div class = "rightBet" >
               <p id = "totalCompChips">Chips: 1000</p>
            </div>
         </div>
         <div class = "lilDiv" style = "margin:0px;">
            <p id = "compMessage" style = "margin:0px;"></p>
         </div>
         <div class = "bigDiv">
            <div class = "farRight"></div>
            <div class = "rightBet" >
               <button type="button" onclick="startPlay()" class="btn btn-primary" id = "b2" >Begin Playing</button>	
            </div>
            <div class = "board">
               <div class = "crop">
                  <img id ="card3" alt = "boardcard" style = "visibility:hidden" src="images/allcards.png" />
               </div>
               <div class = "crop">
                  <img id = "card4" alt = "boardcard" style = "visibility:hidden" src="images/allcards.png" />
               </div>
               <div class = "crop">
                  <img id = "card5" alt = "boardcard" style = "visibility:hidden" src="images/allcards.png" />
               </div>
               <div class = "crop">
                  <img id = "card6" alt = "boardcard" style = "visibility:hidden" src="images/allcards.png" />
               </div>
               <div class = "crop">
                  <img id = "card7" alt = "boardcard" style = "visibility:hidden" src="images/allcards.png" />
               </div>
            </div>
            <div class = "rightBet" >
               <p id = "totalPot">Total Pot: 0</p>
               <p id = "handHistory"><button class="btn-link" onclick = "handHistory()">Click to view last hand history</button></p>
            </div>
            <div class = "farRight"></div>
         </div>
         <div class = "tinyDiv">
            <p id = "playerMessage"></p>
         </div>
         <div class = "bigDiv">
            <div class = "leftBetPlayer">
               <p id = "playerBet">Player Bet: 0</p>
            </div>
            <div class = "compCard">
               <div class = "crop">
                  <img id ="card" alt = "playercard" src="images/allcards.png" />
               </div>
               <div class = "crop">
                  <img id = "card2" alt = "playercard" src="images/aceofsteaks.png" />			
               </div>
               <div class = "divButton">
                  <img id = "imgButtonPlayer" alt = "button" src = "images/button.jpg" />
               </div>
            </div>
            <div class = "rightBetPlayer" >
               <p id = "totalPlayerChips">Chips: 1000</p>
               <p id = "handCounter" style = "visibility:hidden; margin:0px;">Hand # 1</p>
            </div>
         </div>
         <div class = "medDiv">
            <div class = "fbLogin">
               <div class="fb-login-button" data-max-rows="5" data-size="small" data-show-faces="true" data-auto-logout-link="true" data-href= "https://www.facebook.com/GameTheoryOptimalPoker">			
               </div>
            </div>
            <div class = "allPlayerButtons">
               <div class = "bbutton"><button class="btn btn-primary" type="button" onclick="fold()" id = "bfold" >Fold</button></div>
               <div class = "bbutton"><button class="btn btn-primary" type="button" onclick="call()" id = "bcall" >Call</button></div>
               <div class = "bbutton"><button class="btn btn-primary" type="button" onclick="raise()" id = "braise" >Raise</button>
               </div>
            </div>
            <div class = "speedDiv">
               <div>
                  <a onclick = "incSpeed()" id ="incSpeedLink"><img id = "upButton" src = "images/up_button.png"/></a>
               </div>
               <p id = "speedP">Speed: 5</p>
               <div>
                  <a onclick = "decSpeed()" id ="decSpeedLink"><img id = "downButton" src = "images/up_button.png"/></a>
               </div>
            </div>
         </div>
         <div class = "tinyDiv">
            <p id = "totalHandsPlayed"></p>
         </div>
         <img id = "cardFly" alt = "cardfly" src = "images/card_back.png"/>
      </div>
   </body>
   <script>
      window.fbAsyncInit = function() {
        FB.init({
          appId      : '706390152732478',
          status     : true, // check login status
          cookie     : true, // enable cookies to allow the server to access the session
          xfbml      : true,  // parse XFBML
          version    : 'v2.1' // use version 2.0
        });
      
        FB.Event.subscribe('auth.authResponseChange', function(response) {
      	if(!fbFirst) { return; }		
          testAPI();
        }); 
      };
      
      (function(d, s, id) {
       var js, fjs = d.getElementsByTagName(s)[0];
       if (d.getElementById(id)) return;
       js = d.createElement(s); js.id = id;
       js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&appId=706390152732478&version=v2.1";
       fjs.parentNode.insertBefore(js, fjs);
      }(document, 'script', 'facebook-jssdk'));
      
      function testAPI() {
      FB.getLoginStatus(function(response) {
      	if (response.status === 'connected') {
      					
      		FB.api('/me', function(user) {
      			fbName = user.name;
      			fbID = user.id;
      		});
      	}
      	else {
      		fbName = '';
      		fbID = 0;
      	}
      });
      }
      
      var allCards =[];
      var cardNumber = 0;
      var roundNum = 1;
      var button = 0;	//player starts off with button
      var turn = 0; //players turn
      var betRound = 1;
      var betsize = 10;
      var curCompBet = 10;
      var curPlayerBet = 5;
      var compChips = 1000;
      var playerChips = 1000;
      var pot = 0;
      var compGone = 0;  //keeps track of whether comp has played
      var playerGone = 0;
      var winMessage = "";
      var score = 0;
      var compProbs = [.2, .8];
      var percentile = 0;
      var numberHandsPlayed = 0;
      var compStartHandChips = 0;
      var playerStartHandChips = 0;
      var handNum = 0;
      var flagPlayerWin = false;
      var numCompRaises = [0, 0, 0, 0]; //last round, this round
      var numPlayerRaises = [0, 0, 0, 0];
      var betEachRound = [0, 0, 0, 0];
      var drawingHand = 0;
      var pscore = 0; //preflop score
      var pscorePlayer = 0;
      var lastHandMessage = ["",""];
      var lastRaise = [-1, -1, -1, -1]; //keeps track of who raised last
      var bluff = 0;
      var overs = 0;
      var playerPerc = [0, 0, 0];
      var compPerc = [0, 0, 0];
      var fbName = "";
      var fbID = 0;
      var fbFirst = true;
      var totIPSessions = 0;
      var fbURL = '';
      var allInComp = false;
      var allInPlayer = false;
      
      function changeRound()
      {	
      if (roundNum == 1) {
      	animateCard();
      	initiateBluff();
      	twoOvers();
      	
      	}
      else if (roundNum == 2){
      	animateCard();					
      	betsize = 20;
      }
      else if (roundNum == 3) {
      	animateCard();
      }
      else {
      	betEachRound[roundNum - 1] = curCompBet;
      	document.getElementById("card8").src = "images/allcards.png"
      	document.getElementById("card9").src = "images/allcards.png"
      	changecard('card8');
      	changecard('card9');
      	roundNum++;
      	evaluateHands();
      }
      }
      
      function changecard(name){				
      var rank = 0;
      var suit = 0;
      var id = document.getElementById(name);
      rank = allCards[cardNumber] % 13 * -73;
      suit = Math.floor(allCards[cardNumber] / 13) * -98;	
      id.style.margin = suit + "px 0px 0px " + rank + "px";	
      cardNumber++;
      }
      
      function changeCompCardEarly(){				
      var rank = 0;
      var suit = 0;
      var id = document.getElementById("card8");
      document.getElementById("card8").src = "images/allcards.png";				
      rank = allCards[7] % 13 * -73;
      suit = Math.floor(allCards[7] / 13) * -98;	
      id.style.margin = suit + "px 0px 0px " + rank + "px";	
      
      document.getElementById("card9").src = "images/allcards.png";
      id = document.getElementById("card9");
      rank = allCards[8] % 13 * -73;
      suit = Math.floor(allCards[8] / 13) * -98;
      id.style.margin = suit + "px 0px 0px " + rank + "px";				
      }
      
      function getRandomSubarray(arr, size) {
      var shuffled = arr.slice(0), i = arr.length, temp, index;
      for(var i = 51; i >=0; i--)  {
      	index = Math.floor((i+1) * Math.random());
      	temp = shuffled[index];
      	shuffled[index] = shuffled[i];
      	shuffled[i] = temp;
      }
      return shuffled.slice(0, size);
      }
      
      function range(start, end, exclude) {
      var arr = [];
      
      while (start <= end) {
      	if(exclude.indexOf(start) == -1){
      		arr.push(start++)
      	}
      	else {	start++; }
      }
      return arr;
      };
      
      function getCards(){
      cardNumber = 0;
      allCards = getRandomSubarray(range(0,51, []), 9);
      // allCards = [0,1,3,4,5,7,26,11,19];
      //allCards = [9,22,8,19,35,12,25,0,13];
      document.getElementById('card2').style.height = "";
         document.getElementById('card2').style.width = "";
         document.getElementById('card2').src = "images/allcards.png";
        
         changecard('card');
         changecard('card2');
         changecard('card3');
         changecard('card4');
         changecard('card5');
         changecard('card6');
         changecard('card7');   
      }
      
      function startPlay() {		
      	numberHandsPlayed += 1;
       
         document.getElementById("b2").style.visibility="hidden";
         document.getElementById("bfold").style.visibility="visible";
         document.getElementById("bcall").style.visibility="visible";
         document.getElementById("braise").style.visibility="visible";	
         document.getElementById("card3").style.visibility = "hidden";
         document.getElementById("card4").style.visibility = "hidden";
         document.getElementById("card5").style.visibility = "hidden";
         document.getElementById("card6").style.visibility = "hidden";
         document.getElementById("card7").style.visibility = "hidden";
         document.getElementById("card8").src = "images/card_back.png";
         document.getElementById("card9").src = "images/card_back.png";
         document.getElementById("card8").style.visibility = "visible";
         document.getElementById("card9").style.visibility = "visible";
         document.getElementById("card8").style.margin = "0px 0px 0px 0px";
         document.getElementById("card9").style.margin = "0px 0px 0px 0px";
         document.getElementById("handCounter").style.visibility = "visible";
        
         startHand();
               };
      
      function startHand() {
      
      	getTotalHands();
      	
      	if(handNum > 0){ 									
      		document.getElementById("handHistory").style.visibility="visible";						
      	}; 
      	
      	if(compChips  <= 0 || playerChips <= 0) { congratPlayer();}
      			
      	roundNum = 1;
      	betRound = 1;
      	betsize = 10;
      	compGone = 0;
      	playerGone = 0;
      	pot = 0;
      	score = 0;
      	percentile = 0;
      	numCompRaises = [0, 0, 0, 0]; //last round, this round
      	numPlayerRaises = [0, 0, 0, 0];
      	betEachRound = [0, 0, 0, 0];
      	drawingHand = 0;
      	lastRaise = [-1, -1, -1, -1];
      	bluff = 0;
      	overs = 0;
      	playerPerc = [0, 0, 0];
      	compPerc = [0, 0, 0];
      	lastHandMessage[1] = "";
      	totIPSessions = 0;
      	allInComp = false;
      	allInPlayer = false;
      	getCards();
      	
      	compStartHandChips = compChips;
      	playerStartHandChips = playerChips;
      	compProbs = computeProbs();
      	
      	handNum++;
      	lastHandMessage[1] += "<h1>Hand History for hand #" + handNum + "<br></h1>";
      	lastHandMessage[1] += "<p>Player Chips: " + playerChips + "<br>";
      	lastHandMessage[1] += "Computer Chips: " + compChips + "<br></p>"; 
      	lastHandMessage[1] += "<p>You are dealt " + cardToHtml(cardToString(allCards[0])) + " " + cardToHtml(cardToString(allCards[1])) + "<br></p>"; 
      	
      	document.getElementById("handCounter").innerHTML = "Hand # " + handNum;
      			
      	if (button == 0){							
      		curPlayerBet = Math.min(5, playerChips);						
      		curCompBet = Math.min(10, compChips);	
      		
      		document.getElementById("playerMessage").style.visibility = "visible";
      		document.getElementById("playerMessage").innerHTML = "Bet: " + curPlayerBet;
      		document.getElementById("compMessage").innerHTML = " ";
      		document.getElementById("imgButtonPlayer").style.visibility = "visible";				
      		document.getElementById("imgButtonComp").style.visibility = "hidden";						
      		document.getElementById("playerBet").innerHTML = "Player Bet: " + curPlayerBet;
      		document.getElementById("compBet").innerHTML = "Computer Bet: " + curCompBet;
      		lastHandMessage[1] += "<p>Player is button and posts small blind of " + curPlayerBet + "<br>";
      		lastHandMessage[1] += "Computer posts big blind of " + curCompBet + "<br></p>";	
      	}
      	else {											
      		curPlayerBet = Math.min(10, playerChips);
      		curCompBet = Math.min(5, compChips);
      		document.getElementById("compMessage").style.visibility = "visible";
      		document.getElementById("playerMessage").innerHTML = "Bet: " + curPlayerBet;
      		document.getElementById("imgButtonComp").style.visibility = "visible";	
      		document.getElementById("imgButtonPlayer").style.visibility = "hidden";
      		document.getElementById("playerBet").innerHTML = "Player Bet: " + curPlayerBet;
      		document.getElementById("compBet").innerHTML = "Computer Bet: " + curCompBet;
      		lastHandMessage[1] += "<p>Computer is button and posts small blind of " + curCompBet + "<br>";
      		lastHandMessage[1] += "Player posts big blind of " + curPlayerBet + "<br></p>";	
      	}
      	
      	playerChips -= curPlayerBet;
      	compChips -= curCompBet;
      	changeBets();
      	if(compChips == 0 && curCompBet == 5) { togglePlayerButtons(0); compAllIn("calls"); return;}
      	if(playerChips == 0 && curPlayerBet == 5) { togglePlayerButtons(0); playerAllIn("call"); return;}	
      	if (button == 0){
      	
      		playerTurn();
      	}
      	else {
      		compTurn();
      	}		
      };
      	
      function determineTurn(){
      	pot = pot + curCompBet + curPlayerBet;
      	curCompBet = 0;
      	curPlayerBet = 0;
      	betRound = 0;
      	compGone = 0;
      	playerGone = 0;
      	changeBets();
      	changeCurrBets();
      	document.getElementById("compMessage").innerHTML = " ";
      	if (button == 0){	//player is button so computer goes first					
      		compTurn();					
      	}
      	else {
      		playerTurn();						
      	}				
      }
      
      function playerTurn() {		
      	if (roundNum > 4) {
      		evaluateHands();
      		togglePlayerButtons(0);
      		return(0);
      	}
      	
      	if(allInPlayer){
      		playerAllIn();
      		return(0);
      	}
      
      	if(playerChips == 0) { togglePlayerButtons(0); playerAllIn("call"); return;}
      		
      	if(allInComp && curCompBet == 0){ togglePlayerButtons(0); compTurn(); }		
      	document.getElementById("playerMessage").style.visibility ="visible";
      	togglePlayerButtons(1);
      	changeButtons();											
      };
      
      function compTurn(){
      	togglePlayerButtons(0);
      	if(allInComp){
      		compAllIn();
      		return(0);
      	}
      	
      	if(compChips == 0) { togglePlayerButtons(0); compAllIn("calls"); return;}
      		
      	if(compChips <= betsize && curCompBet < curPlayerBet || (playerChips <= betsize && playerGone == 1 && curPlayerBet > 0)){
      		compCall();
      		return(0);
      	}
      	
      	if(allInPlayer && curPlayerBet == 0) { playerAllIn("call"); return;}
      	probAdjustment();
      
      	var rand = Math.random();
      	if(curCompBet == curPlayerBet){
      		if (rand < compProbs[1]) { //comp checks
      			compCheck();										
      		} 
      		else {
      			compRaise();
      		}	
      		return(0);
      	}
      	
      	if (betRound == 4){
      		compProbs[1] = 1;	
      	}
      	
      	if (curCompBet == 5){
      		if (rand < compProbs[0]) {compFold(); return(0);}
      		else if (rand < compProbs[1]) { compCall(); }	
      		else { compRaise();}					
      		return(0);
      	}
      	
      	if (curCompBet < curPlayerBet){
      		if (rand < compProbs[0]) {compFold(); return(0);}
      		else if (rand < compProbs[1]) { compCall(); }	
      		else { compRaise();}
      		return(0);
      	}
      }
      
      function changeBets() {
      		document.getElementById("totalPlayerChips").innerHTML ="Chips: " + playerChips;
      		document.getElementById("totalCompChips").innerHTML ="Chips: " + compChips;						
      		document.getElementById("totalPot").innerHTML = "Total Pot: " + pot;				
      }
      
      function changeCurrBets() {
      	document.getElementById("playerBet").innerHTML = "Player Bet: " + curPlayerBet;
      	if(!allInPlayer) { document.getElementById("playerMessage").innerHTML = "Bet: " + curPlayerBet; }
      	document.getElementById("compBet").innerHTML = "Computer Bet: " + curCompBet;
      }
      
      function changeButtons(){
      	var foldb = document.getElementById("bfold");
      	var callb = document.getElementById("bcall");
      	var raiseb = document.getElementById("braise");
      	
      	if(curCompBet == 0 && curPlayerBet == 0) {
      		callb.style.visibility = "hidden";
      		foldb.innerHTML = "Check";
      		raiseb.innerHTML = "Bet " + (curCompBet + Math.min(playerChips, betsize));			
      	}
      	else {
      	
      		if (betRound < 4) {								
      			raiseb.innerHTML = "Raise to " + Math.min(playerChips + curPlayerBet, betsize + curCompBet);
      			foldb.innerHTML = "Fold";
      			if(playerChips <= curCompBet - curPlayerBet) { raiseb.style.visibility = "hidden"; }
      		}
      		else {
      			raiseb.style.visibility = "hidden";
      		}
      	
      		if (roundNum == 1 && betRound == 1 && curCompBet == curPlayerBet) {								
      			callb.style.visibility = "hidden";
      			foldb.innerHTML = "Check";
      			raiseb.innerHTML = "Raise to " + (curCompBet +  Math.min(playerChips, betsize));
      		}						
      		else {								
      			callb.innerHTML = "Call " + Math.min((curCompBet - curPlayerBet), playerChips);
      			foldb.innerHTML = "Fold";
      		}								
      	}
      	
      	if(allInComp) {
      		raiseb.style.visibility = "hidden";
      	}	
      }
      
      function togglePlayerButtons(indicator) {
      	var foldb = document.getElementById("bfold");
      	var callb = document.getElementById("bcall");
      	var raiseb = document.getElementById("braise");
      	if(indicator == 1){
      		foldb.style.visibility = "visible";
      		callb.style.visibility = "visible";
      		raiseb.style.visibility = "visible";
      	} else {
      		foldb.style.visibility = "hidden";
      		callb.style.visibility = "hidden";
      		raiseb.style.visibility = "hidden";
      	}				
      }
      
      function changeDealer(){
      	if(button == 0) { button = 1;}
      	else { button = 0; }
      }
      
      function fold() {
      	if (document.getElementById("bfold").innerHTML == "Check"){
      		playerGone = 1;
      		lastHandMessage[1] += "<p>Player checks<br></p>";
      		if(continueHand()) {compTurn();}
      	}
      	else {
      		document.getElementById("playerMessage").innerHTML ="You folded. Computer wins pot."
      		togglePlayerButtons(0);
      		compChips += pot + curCompBet + curPlayerBet;
      		betEachRound[roundNum - 1] = curPlayerBet;
      		changeDealer();
      		changeBets();
      		lastHandMessage[1] += "<p>Player folds<br></p>";
      		lastHandMessage[1] += "<p>Computer wins " + (pot / 2 + curPlayerBet) + " chips<br>";
      		lastHandMessage[1] += "Player Chips: " + playerChips + "<br>";
      		lastHandMessage[1] += "Computer Chips: " + compChips + "<br></p>"; 
      		lastHandMessage[0] = lastHandMessage[1] + lastHandMessage[0];
      		document.getElementById("bcall").innerHTML = "Next Hand";
      		document.getElementById("bcall").style.visibility = "visible";
      		enterHand(compChips - compStartHandChips);
      	}
      }
      
      function call() {
      	if(document.getElementById("bcall").innerHTML == "Next Hand") { 
      		document.getElementById("bcall").innerHTML = "Call";
      		startPlay();
      		return(0);
      	}
      	
      	if( (curCompBet - curPlayerBet) >= playerChips){ //allIN
      			playerAllIn("call");
      			return(0);
      	}
      	
      	playerChips = playerChips - (curCompBet - curPlayerBet);
      	curPlayerBet = curCompBet;
      	changeBets();
      	changeCurrBets();
      	lastHandMessage[1] += "<p>Player calls to " + curPlayerBet + "<br></p>";
      	playerGone = 1;
      	
      	if (compGone == 0) { compTurn(); }
      	else { continueHand(); }
      }			
      
      function raise(){				
      	playerGone = 1;
      	compGone = 0;
      	betRound += 1;
      	if( playerChips - (curCompBet - curPlayerBet + betsize) <= 0){ //allIN
      			playerAllIn("raise");
      			return(0);
      	}
      	
      	playerChips = playerChips - (curCompBet - curPlayerBet + betsize);
      	curPlayerBet = curCompBet + betsize;
      	
      	changeBets();
      	changeCurrBets();	
      	if(curCompBet == 0) {
      		lastHandMessage[1] += "<p>Player bets " + curPlayerBet + "<br></p>";
      	} else {
      		lastHandMessage[1] += "<p>Player raises to " + curPlayerBet + "<br></p>";
      	}
      	numPlayerRaises[roundNum - 1] += 1;
      	lastRaise[roundNum - 1] = 0; //player makes last raise
      	compTurn();									
      }
      				
      function compCheck() {
      	document.getElementById("compMessage").innerHTML = "Computer checks";
      	document.getElementById("compMessage").style.visibility = "visible";
      	lastHandMessage[1] += "<p>Computer Checks<br></p>";
      	var i = 0;
      	var numJumps = 50;
      	var  speedAdj = parseInt(getSpeedAdj());
      	var myInt = setInterval(function(){
      		document.getElementById("compMessage").style.fontSize = (1 + .5 / numJumps * i) + "em";
      		i += 1;
      		if(i == numJumps) {
      			clearInterval(myInt);
      			changeCurrBets();
      			compGone = 1;
      			if (continueHand()){ playerTurn(); }													
      		}
      	}	, 14 - speedAdj * 1.2);			
      }
      
      function compCall(){
      	compGone = 1;
      	if( (curPlayerBet - curCompBet) >= compChips){ //allIN
      		compAllIn("calls");
      		return(0);
      	}
      
      	var i = 0;
      	var numJumps = 50;
      	var  speedAdj = parseInt(getSpeedAdj());
      	document.getElementById("compMessage").innerHTML = "Computer calls to " + curPlayerBet;
      	document.getElementById("compMessage").style.visibility = "visible";
      	lastHandMessage[1] += "<p>Computer calls to " + curPlayerBet + "<br></p>";
      	
      	var myInt = setInterval(function(){
      		document.getElementById("compMessage").style.fontSize = (1 + .5 / numJumps * i) + "em";
      		i += 1;
      		if(i == numJumps) {
      			clearInterval(myInt);
      			compChips = compChips - (curPlayerBet - curCompBet);
      			curCompBet = curPlayerBet;
      			changeBets();
      			changeCurrBets();		
      			if (continueHand()){ playerTurn(); }								
      		}
      	} , 14 - speedAdj * 1.2);												
      }
      
      function compRaise(){
      	compGone = 1;
      	playerGone = 0;
      	betRound += 1;
      	numCompRaises[roundNum - 1] += 1;
      
      	if( compChips - (curPlayerBet - curCompBet + betsize) <= 0){ //allIN
      		compAllIn("raises");
      		return(0);
      	}
      	
      	var i = 0;
      	var numJumps = 50;
      	var  speedAdj = parseInt(getSpeedAdj());
      	compChips = compChips - (curPlayerBet - curCompBet + betsize);
      	curCompBet = curPlayerBet + betsize;
      	
      	if (curPlayerBet == 0) {
      		document.getElementById("compMessage").innerHTML = "Computer bets " + curCompBet;
      		lastHandMessage[1] += "<p>Computer bets " + curCompBet + "<br></p>";
      	}
      	else {
      		document.getElementById("compMessage").innerHTML = "Computer raises to " + curCompBet;
      		lastHandMessage[1] += "<p>Computer raises to " + curCompBet + "<br></p>";
      	}
      	document.getElementById("compMessage").style.visibility = "visible";
      	lastRaise[roundNum - 1] = 1; //comp makes last raise
      	
      	var myInt = setInterval(function(){
      		document.getElementById("compMessage").style.fontSize = (1 + .5 / numJumps * i) + "em";
      		i += 1;
      		if(i == numJumps) {
      			clearInterval(myInt);
      			changeBets();
      			changeCurrBets();
      					
      			if (continueHand()){ playerTurn(); }								
      		}
      	}, 14 - speedAdj * 1.2);											
      }
      
      function compFold(){
      	var i = 0;	
      	var numJumps = 50;
      	var  speedAdj = parseInt(getSpeedAdj());
      	document.getElementById("compMessage").innerHTML = "Computer folds. You win pot.";						
      	document.getElementById("compMessage").style.visibility = "visible";
      	lastHandMessage[1] += "<p>Computer folds <br></p>";
      	togglePlayerButtons(0);
      	playerChips += pot + curCompBet + curPlayerBet;
      	lastHandMessage[1] += "<p>Player wins " + (pot / 2 + curCompBet) + " chips<br>";
      	lastHandMessage[1] += "Player Chips: " + playerChips + "<br>";
      	lastHandMessage[1] += "Computer Chips: " + compChips + "<br></p>"; 
      	lastHandMessage[0] = lastHandMessage[1] + lastHandMessage[0];
      	betEachRound[roundNum - 1] = curCompBet;
      	changeDealer();
      	changeBets();
      	enterHand(compChips - compStartHandChips);
      	
      	var myInt = setInterval(function(){
      		document.getElementById("compMessage").style.fontSize = (1 + .5 / numJumps * i) + "em";
      		i += 1;
      		if(i == numJumps) {
      			clearInterval(myInt);								
      			document.getElementById("bcall").innerHTML = "Next Hand";
      			document.getElementById("bcall").style.visibility = "visible";								
      		}
      	} , 14 - speedAdj * 1.2);													
      }
      
      function compAllIn(message){
      	togglePlayerButtons(0);
      	allInComp = true;
      	if(message == "calls") {
      		curCompBet = curCompBet + compChips;
      		curPlayerBet = curCompBet;
      	} else if (message == "raises"){
      		curCompBet = curCompBet + compChips;
      	}
      	
      	var i = 0;
      	var numJumps = 50;
      	var  speedAdj = parseInt(getSpeedAdj());
      	
      	if(curCompBet == 0 || compChips == 0) {
      		document.getElementById("compMessage").innerHTML = "Computer is all in";
      		document.getElementById("compMessage").style.visibility = "visible";
      		lastHandMessage[1] += "<p>Computer is all in" + "<br></p>";
      		playerGone = 1;
      	} else {
      		document.getElementById("compMessage").innerHTML = "Computer " + message + " to " + curCompBet + " and is all in";
      		document.getElementById("compMessage").style.visibility = "visible";
      		lastHandMessage[1] += "<p>Computer " + message + " to " + curCompBet + " and is all in" + "<br></p>";
      	}
      	compGone = 1;
      	lastRaise[roundNum - 1] = 0;
      	
      	var myInt = setInterval(function() {
      		document.getElementById("compMessage").style.fontSize = (1 + .5 / numJumps * i) + "em";
      		i += 1;
      		if(i == numJumps) {
      			clearInterval(myInt);
      			compChips = 0;
      			changeBets();
      			changeCurrBets();		
      			if (continueHand()){ playerTurn(); }								
      		}
      	} , 14 - speedAdj * 1.2);										
      }
      
      function playerAllIn(message){
      	allInPlayer = true;
      	if(message == "call") {
      		curPlayerBet = curPlayerBet + playerChips;
      		curCompBet = curPlayerBet;
      		lastRaise[roundNum - 1] = 1;
      	} else if (message == "raise"){
      		curPlayerBet = curPlayerBet + playerChips;							
      	}						
      
      	var i = 0;
      	var numJumps = 50;
      	var  speedAdj = parseInt(getSpeedAdj());
      	
      	if(curPlayerBet == 0 || playerChips == 0) {
      		document.getElementById("playerMessage").innerHTML = "Player is all in";
      		document.getElementById("playerMessage").style.visibility = "visible";
      		lastHandMessage[1] += "<p>Player is all in" + "<br></p>";
      		compGone = 1;
      		lastRaise[roundNum - 1] = -1;
      	} else {
      		document.getElementById("playerMessage").innerHTML = "You " + message + " to " + curPlayerBet + " and are all in";
      		document.getElementById("playerMessage").style.visibility = "visible";
      		lastHandMessage[1] += "<p>Player " + message + " to " + curPlayerBet + " and is all in" + "<br></p>";
      	}
      	playerGone = 1;
      	
      	var myInt = setInterval(function(){
      		document.getElementById("playerMessage").style.fontSize = (1 + .5 / numJumps * i) + "em";
      		i += 1;
      		if(i == numJumps) {
      			clearInterval(myInt);
      			playerChips = 0;
      			//compGone = 1;
      			changeBets();
      			changeCurrBets();		
      			if (continueHand()){ compTurn(); }								
      		}
      	} , 14 - speedAdj * 1.2);												
      }
      
      function evaluateHands(){
      	var playerValue = 0;
      	var compValue = 0;				
      	
      	togglePlayerButtons(0);
      	pot = pot + curCompBet + curPlayerBet;
      	curCompBet= 0; 
      	curPlayerBet = 0;
      	changeBets();
      	changeCurrBets();
      	changeDealer();
      	score = 0;
      	playerValue = handValue(allCards.slice(0,7));
      	score = playerValue;
      	compValue = handValue(allCards.slice(2,9));
      	
      	document.getElementById("compMessage").innerHTML = " ";
      
      	if(playerValue > compValue) {
      		playerChips = playerStartHandChips + pot / 2;
      		document.getElementById("playerMessage").innerHTML = "You win with " + winMessage;
      		lastHandMessage[1] += "<p>Player wins " + pot/2 + " chips with " + winMessage + "<br></p>";	
      	}
      	else if (compValue > playerValue){
      		compChips = compStartHandChips + pot / 2;
      		document.getElementById("playerMessage").innerHTML = "Computer wins with " + winMessage;
      		lastHandMessage[1] += "<p>Computer wins " + pot / 2 + " chips with " + winMessage + "<br></p>";
      	}
      	else {
      		compChips += pot / 2;
      		playerChips += pot / 2;
      		document.getElementById("playerMessage").innerHTML = "Players split with " + winMessage;
      	}
      
      	lastHandMessage[1] += "<p>Computer was dealt " + cardToHtml(cardToString(allCards[7])) + " " + cardToHtml(cardToString(allCards[8])) + "<br></p>"; 						
      	lastHandMessage[1] += "<p>Player Chips: " + playerChips + "<br></p>";
      	lastHandMessage[1] += "<p>Computer Chips: " + compChips + "<br></p>"; 	
      	lastHandMessage[0] = lastHandMessage[1] + lastHandMessage[0];
      	document.getElementById("bcall").innerHTML = "Next Hand";
      	document.getElementById("bcall").style.visibility = "visible";
      	changeBets();							
      	enterHand(compChips - compStartHandChips); //write to db
      }
      
      function continueHand() {	
      	if (compGone && playerGone){							
      		changeRound();	
      			return(0);
      	}
      	else {
      			return(1);
      	}
      }
      
      function handValue(cards) {
      	return(Math.max(checkFlush(cards), check4(cards) , straightScore(checkStraight(getUniqueCards(getRank(cards)))))); //just multiply straightCard here
      }
      
      function checkFlush(cards) {
      	var suits = new Array(7);
      	var isFlush = false;
      	var flushSuit = -1;
      	var flushCards = new Array();
      	var straightCard = -1;
      	var tempScore = 0;
      	
      	for(var i = 0; i < cards.length; i++) {
      		suits[i] = Math.floor(cards[i] / 13);
      	}
      	//check if there are 5 or more of same suit
      	for(var i = 0; i < 4; i++){
      		if(suits.filter(function(value) { return value == i}).length >= 5) {
      			isFlush = true;
      			flushSuit = i;
      		}
      	}
      	
      	if(isFlush) {  // there is a flush
      		var j = 0;
      		var tempScore = score;
      		
      		for(var i = 0; i < cards.length; i++) {
      			if(suits[i] == flushSuit){
      				flushCards[j] = cards[i];
      				j += 1;
      			}
      		}
      		
      		flushCards = getRank(flushCards);
      		
      		straightCard = checkStraight(flushCards);
      		if(isFlush && straightCard > 0)
      		{
      		 tempScore = (straightCard + 4) / 14 * 400000000;
      		 if(tempScore > score){
      			winMessage = " straight flush " + getCardName(straightCard + 4) + " high";
      			score = tempScore;
      		 }
      		 return(tempScore);
      		}
      		flushCards = changeAce(flushCards);
      		tempScore = check4(flushCards) * 100000;
      		if(tempScore > score){
      			flushCards.sort(function(a,b){return b-a});
      			winMessage = " flush " + getCardName(flushCards[0] + 1) + " high";
      			score = tempScore;
      		 }
      		 
      		return(tempScore); //will get high card valuation since all flush have unique rank
      	}
      	return(0);
      }
      
      function checkStraight(cards) {
      	var scards = new Array();
      	var isStraight = 0;
      	var straightCard = -1;
      	scards = getRank(cards);
      	scards.sort(function(a,b){return a-b});
      	straightCard = rowStraight(scards);
      	scards = changeAce(scards).sort(function(a,b){return a-b});					
      	straightCard = Math.max(rowStraight(scards), straightCard);					
      	return(straightCard);					
      }
      
      function rowStraight(cards){
      	var straightCard = -1;
      	for(var i = 0; i < cards.length - 4; i++){ //check if in a row
      		
      		for (var j = 0; j < 4; j++) {
      			if(cards[i + j + 1] - cards[i + j] != 1) {
      				j = 6;
      			}
      		}
      		if(j == 4) { // straight
      			straightCard = cards[i];		
      		}					
      	}
      	return(straightCard + 1);
      }
      
      function check4(cards){	//check for 4 of a kind
      	var fourRank = 0;
      	var threeRank = new Array();
      	var threeCount = 0;
      	var twoRank = new Array();
      	var twoCount = 0;
      	var oneRank = new Array();
      	var oneCount = 0;
      	var tempScore = score;
      	rcards = getRank(cards);
      	var maxKicker = 0;
      	for(var i = 0; i < 13; i++){
      		switch(rcards.filter(function(value) { return value == i}).length) {
      			case 4:
      			fourRank = changeAceValue(i);
      			break;
      			case 3:
      			threeRank[threeCount++] = changeAceValue(i);
      			break;
      			case 2:
      			twoRank[twoCount++] = changeAceValue(i);
      			break;
      			case 1:
      			oneRank[oneCount++] = changeAceValue(i);
      			break;
      		}
      	}
      	oneRank.sort(function(a,b){return b-a});
      	twoRank.sort(function(a,b){return b-a});
      	threeRank.sort(function(a,b){return b-a});
      	
      	if (fourRank > 0) {					
      		maxKicker = Math.max(oneRank[0] || 0, twoRank[0] || 0, threeRank[0] || 0); // the || 0 turns NAN to 0 but leaves the value
      		tempScore = (fourRank + 1) / 13 * 20000000 + maxKicker / 13;
      		if(tempScore > score){
      			winMessage = " four of a kind " + getCardName(fourRank + 1) + "'s " + getCardName(maxKicker + 1) + " kicker";
      			score = tempScore;
      		 }
      		return(tempScore);
      	}
      	else if(threeCount == 2){
      		tempScore = ((threeRank[0] / 13) * 20 + threeRank[1] / 13) / 11 * 1000000;
      		if(tempScore > score){
      			winMessage = " full house " + getCardName(threeRank[0] + 1) + "'s full of " + getCardName(threeRank[1] + 1) + "'s";
      			score = tempScore;
      		 }
      		return(tempScore);
      	}
      	else if(threeCount == 1 && twoCount >= 1){						
      		tempScore = (threeRank[0] / 13 * 20 + twoRank[0] / 13)/11 * 1000000;
      		if(tempScore > score){
      			winMessage = " full house " + getCardName(threeRank[0] + 1) + "'s full of " + getCardName(twoRank[0] + 1) + "'s";
      		    score = tempScore;
      		 }
      		return(tempScore);
      	}
      	
      	else if(threeCount == 1){
      		tempScore = (threeRank[0] / 13 * 200 + oneRank[0] / 13 * 10 + oneRank[1] / 13) / 111 * 1000;
      		if(tempScore > score){
      			winMessage = " three of kind " + getCardName(threeRank[0] + 1) + "'s "+ getCardName(oneRank[0] + 1) + " kicker";
      			score = tempScore;
      		 }
      		return(tempScore);
      	}
      	else if(twoCount >= 2){
      		maxKicker = Math.max(oneRank[0] || 0, twoRank[2] || 0);
      		tempScore = (twoRank[0] / 13 * 200 + twoRank[1] / 13 * 10 + maxKicker / 13) / 111 * 100;
      		if(tempScore > score){
      			winMessage = " two pair " + getCardName(twoRank[0] + 1) + "'s and " + getCardName(twoRank[1] + 1) + "'s " + getCardName(maxKicker + 1) + " kicker";
      			score = tempScore;
      		 }
      		return(tempScore);
      	}
      	else if (twoCount == 1) {
      		tempScore = (twoRank[0] / 13 * 1000 + oneRank[0] / 13 * 100 + oneRank[1] / 13 * 10 + oneRank[2] / 13) / 1111 * 10;
      		if(tempScore > score){
      			winMessage = " one pair " + getCardName(twoRank[0] + 1) + "'s " + getCardName(oneRank[0] + 1) + " kicker";
      			score = tempScore;
      		 }
      		return(tempScore);
      	}
      	else {
      		tempScore = (oneRank[0] / 13 * 10000 + oneRank[1] / 13 * 1000 + oneRank[2] / 13 * 100 + oneRank[3] / 13 * 10 + oneRank[4] / 13) / 11111 * 1;
      		if(tempScore > score){
      			winMessage = " high card " + getCardName(oneRank[0] + 1) + " " + getCardName(oneRank[1] + 1) + " high";
      			score = tempScore;
      		 }
      		return(tempScore);	
      	}
      }
      
      function straightScore(straightCard) {
      	var tempScore = 0;
      	if(straightCard) {tempScore = (straightCard + 4) / 14 * 10000; }
      	if(tempScore > score){
      		winMessage = " straight " + getCardName(straightCard + 4) + " high";
      		score = tempScore;
      	}
      	return(tempScore);
      }
      
      function changeAce(cards){
      	for(var i = 0; i < cards.length; i++){
      		if (cards[i] == 0){
      			cards[i] = 13;
      		}
      	}
      	return(cards);
      }
      
      function getRank(cards){
      var scards = new Array();
      	for(var i = 0; i < cards.length; i++){ //get rank
      		scards[i] = cards[i] % 13;						
      	}
      	return(scards);
      }
      
      function getSuit(cards){
      var scards = new Array();
      	for(var i = 0; i < cards.length; i++){ //get rank
      		scards[i] = Math.floor(cards[i] / 13);						
      	}
      	return(scards);
      }
      
      function changeAceValue(n){
      	if(n == 0){
      		return(13);
      	}
      	else { return(n); }
      }
      
      function getCardName(card){
      	if(card <= 10 && card >= 2){
      		return(card);
      	}
      	else {
      		switch(card) {
      			case 11:
      				return("jack");
      				break;
      			case 12:
      				return("queen");
      				break
      			case 13:
      				return("king");
      				break;
      			default:
      				return("ace");
      				break;
      		}
      	}
      }
      
      Array.prototype.getUnique = function(){
      	var u = {}, a = [];
      	for(var i = 0, l = this.length; i < l; ++i){
      		if(u.hasOwnProperty(this[i])) {
      			continue;
      		}
      		a.push(this[i]);
      		u[this[i]] = 1;
      	}	
      	return a;
      }
      
      function getUniqueCards(cards){
      	var ucards = new Array();
      	var indy = -1;
      	for(var i = 0; i < cards.length; i++) {
      		indy = ucards.indexOf(cards[i]);
      		if(indy == -1){
      			ucards[ucards.length] = cards[i];
      		}				
      	}	
      	return(ucards);
      }
      
      function animateCard() {
      	var fly = document.getElementById("cardFly");
      	var i = 0;
      	var top = -10;
      	var left = -10;
      	var numJumps = 95; //number of jumps for animation
      	var  speedAdj = parseInt(getSpeedAdj());
      	togglePlayerButtons(0);
      	getCurCompHandValue(1);	//get comp percentile
      	getCurCompHandValue(0); //get player percentile	
      	
      	if(roundNum < 3) { getFutValue(); };
      			
      	betEachRound[roundNum - 1] = curCompBet;
      	roundNum++;
      	
      	var slopes = findSlope(numJumps);
      	fly.style.visibility = "visible";
      	var myInt = setInterval(function() {
      		i += 1;
      		top += slopes[1];
      		left += slopes[0];
      		fly.style.top = top + "px";
      		fly.style.left = left + "px";
      		if(i == numJumps){
      			clearInterval(myInt);
      			fly.style.visibility = "hidden";
      			makeCardVisible();
      			
      			if (roundNum > 4) {
      				evaluateHands();
      					
      					return(0);
      				}
      				determineTurn(); 
      				return(0);
      		}
      	} , 13 - speedAdj * 1.1); //was 50
      }
      
      function getSpeedAdj() {
      	return(document.getElementById("speedP").innerHTML.substring(7));				
      }
      
      function decSpeed(){
      	var speed = parseInt(document.getElementById("speedP").innerHTML.substring(7));
      	document.getElementById("speedP").innerHTML = "Speed : " + Math.max(1,speed - 1);
      }
      
      function incSpeed(){
      	var speed = parseInt(document.getElementById("speedP").innerHTML.substring(7));
      	document.getElementById("speedP").innerHTML = "Speed : " + Math.min(10, speed + 1);
      }
      
      function makeCardVisible() {
      switch(roundNum - 1) {
      	case 1:
      			document.getElementById("card3").style.visibility="visible";
      			document.getElementById("card4").style.visibility="visible";
      			document.getElementById("card5").style.visibility="visible";
      			lastHandMessage[1] += "<p><br>Flop: " + cardToHtml(cardToString(allCards[2])) + " " +  cardToHtml(cardToString(allCards[3])) + " " + cardToHtml(cardToString(allCards[4])) + "<br></p>"; 
      			break;
      	case 2 :
      		document.getElementById("card6").style.visibility="visible";
      		lastHandMessage[1] += "<p><br>Turn: " + cardToHtml(cardToString(allCards[2])) + " " +  cardToHtml(cardToString(allCards[3])) + " " + cardToHtml(cardToString(allCards[4])) + " " + cardToHtml(cardToString(allCards[5])) + "<br></p>"; 
      		break;
      	case 3:
      		document.getElementById("card7").style.visibility="visible";
      		lastHandMessage[1] += "<p><br>River: "+ cardToHtml(cardToString(allCards[2])) + " " +  cardToHtml(cardToString(allCards[3])) + " " + cardToHtml(cardToString(allCards[4])) + " " + cardToHtml(cardToString(allCards[5])) + " " + cardToHtml(cardToString(allCards[6])) + "<br></p>"; 
      		break;
      }
      }
      	
      function computeProbs(cards) { //computes probabilities for computer
      //var probs = [0, 0]
      if(roundNum == 1) {
      	pscore = computePreflopProb(1);
      	pscorePlayer = computePreflopProb(0);
      	if(button == 1) { //comp has button
      		if(pscore < 63) { return([.8,.8]); }
      		else if(pscore < 72) { return([0, 0]); }
      		else if(pscore < 90) { return([0, 0]); }
      		else if(pscore < 100) { return([0, 0]); }
      		else if(pscore < 110) { return([0, 0]); }
      		else if(pscore < 130) { return([0, 0]); }
      		else if(pscore < 150) { return([0, 0]); }
      		else { return([0, 0]); }
      	}
      	
      	else {
      		if(pscore < 67) { return([1, 1]); }
      		else if(pscore < 75) { return([.6, 1]); }
      		else if(pscore < 85) { return([0, 1]); }
      		else if(pscore < 90) { return([0, 1]); }
      		else if(pscore < 100) { return([0, 1]); }
      		else if(pscore < 110) { return([0, 1]); }
      		else if(pscore < 130) { return([0, 0]); }
      		else if(pscore < 150) { return([0, 0]); }
      		else { return([0, 0]); }
      	}										
      }
      return(0);
      }
      	
      function getSuitName(card) {
      switch(card){
      	case 0:
      		return("c");
      		break;
      	case 1:
      		return("s");
      		break;
      	case 2:
      		return("d");
      		break;
      	case 3:
      		return("h");
      		break;			
      }
      }
      
      function computePreflopProb(who){
      if(who == 1) {var cards = allCards.slice(7,9);}
      else { var cards = allCards.slice(0,2);}
      var rcards = changeAce(getRank(cards));
      var scards = getSuit(cards);
      
      var tempScore = 0;		
      var valueCards = [20,21,23,25,28,32,36,41,47,55,65,80,100];
      							
      tempScore = valueCards[rcards[0] - 1] + valueCards[rcards[1] - 1];
      if(rcards[0] == rcards[1]) { tempScore += 60; } //pair
      if(scards[0] == scards[1]) { tempScore += 12; } //suited
      if(Math.abs(rcards[0] - rcards[1]) == 1) { tempScore += 7; } //straight
      if(Math.abs(rcards[0] - rcards[1]) == 2) { tempScore += 4; } //straight
      if(Math.abs(rcards[0] - rcards[1]) > 5) { tempScore -= 7; } //too far apart
      						
      return(tempScore);
      }
      
      function getCurCompHandValue(who){
      var board = allCards.slice(2, roundNum + 4)
      if(who == 1) {	var cards = board.concat(allCards.slice(7,9));}
      else { var cards = board.concat(allCards.slice(0,2));}
      
      var handv = handValue(cards);
      var temp = 0;
      var tempCards = [];
      var winners = 0;
      var totalTrials = 0;
      
      for(var i = 0; i < 52; i++) {
      	if(cards.indexOf(i) != -1) {continue;}
      	for(var j = i + 1; j < 52; j++){ 
      		if(cards.indexOf(j) != -1) {continue;}
      		tempCards = board.concat([i, j]);
      		temp = handValue(tempCards);
      		if(handv > temp) { winners++; }
      		else if (handv == temp) { winners += 1; }
      		totalTrials++;
      	}
      }
      if(who == 1 ) { percentile = winners / totalTrials * 100; compPerc[roundNum - 1] = percentile; }
      else { playerPerc[roundNum - 1] = winners / totalTrials * 100; }
      
      generalCompProbs();				
      }
      
      function getFutValue() {
      var boardCards = allCards.slice(2, roundNum + 4);
      var compCards = allCards.slice(7, 9);
      var cards = boardCards.concat(compCards);
      var isFlush = false;
      var isStraight = false;
      var suits = [];
      var cardRanks = getRank(compCards);
      var scard = 0;
      var numStraights = 0;
      var check1 = false;
      var check2 = false;
      //don't look for straight draws on 4 flush boards
      
      for(var i = 0; i < cards.length; i++) {
      		suits[i] = Math.floor(cards[i] / 13);
      	}
      	
      if(suits[suits.length - 1] == suits[suits.length - 2]) {				
      //check if there are 5 or more of same suit
      	for(var i = 0; i < 4; i++){
      		if(suits.filter(function(value) { return value == i}).length == 4) {
      			isFlush = true;							
      		}
      	}
      }
      
      for(var i = 0; i < 52; i++) {
      	check1 = false;
      	check2 = false;
      	if(cards.indexOf(i) == -1) { cardst = cards.concat(i);} else { continue; }
      	scard = checkStraight(getUniqueCards(getRank(cardst)));
      	if(scard == 0) {continue;} else {scard += 4; }
      	
      	if(Math.abs(scard - changeAceValue(cardRanks[0]))  <= 4 && Math.abs(scard - changeAceValue(cardRanks[1]))  <= 4) 
      	{  check1 = true; }
      	
      	if( Math.abs(scard - changeAceValue(cardRanks[0]))  <= 1 || Math.abs(scard - changeAceValue(cardRanks[1]))  <= 1)
      	{ check2 = true; }
      	
      	if(check1 || check2) { numStraights++;} 
      }
      
      if(numStraights >= 8) { isStraight = true; }
      if(isFlush || isStraight) { drawingHand = 1; }
      }
      
      function twoOvers() {
      var boardCards = changeAce(getRank(allCards.slice(2, 5)));
      var compCards = changeAce(getRank(allCards.slice(7, 9)));	
      if(compCards[0] > boardCards.max() && compCards[1] > boardCards.max() && compCards.min() >=9) { overs = 1;}	
      }
      
      function initiateBluff() {	
      	if(Math.random() > .5) { bluff = 1;} // was .7	
      }	
      
      
      function generalCompProbs(){
      var temp = numPlayerRaises[0];
      if(button == 1) { numPlayerRaises[0] = Math.max(numPlayerRaises[0] - 1, 0); }	
      
      if(percentile <= 30) { compProbs = [1, 1]; } // fold all bad hands
      
      else if(percentile < 40) { 
      	if (button == 1) {
      		compProbs = [1, 1];
      		if (numPlayerRaises[roundNum - 2] > 0 ) {compProbs[1] = 1;};
      	}
      	else {
      		compProbs = [1, 1];
      		if (numPlayerRaises[roundNum - 2] > 0 ) {compProbs[1] = 1;};
      	}
      }
      	
      else if(percentile < 45) { //if first to enter pot bet but don't raise
      	compProbs = [0, .7]; 
      	if(button == 1) {
      		switch(numPlayerRaises[roundNum - 2]){
      			case 0: if(betRound == 0) {compProbs = [0, .5];} else { compProbs = [1, 1];} break; // was compProbs = [.7, 1];
      			case 1: compProbs = [1, 1]; break;
      			case 2: compProbs = [1, 1]; /*alert("folding 40 - 50 percentile");*/ break;						
      		}
      	}
      	else {
      		switch(numPlayerRaises[roundNum - 2]){
      			case 0: if(betRound == 0) {compProbs = [0, .5];} else { compProbs = [1, 1];}  break; // was compProbs = [0, 1];
      			case 1: compProbs = [1, 1]; break;
      			case 2: compProbs = [1, 1]; /* alert("folding 40 - 50 percentile"); */ break;	
      		}
      	}
      }
      
      else if(percentile < 50) { //if first to enter pot bet but don't raise
      	compProbs = [0, .7]; 
      	if(button == 1) {
      		switch(numPlayerRaises[roundNum - 2]){
      			case 0: if(betRound == 0) {compProbs = [0, .5];} else { compProbs = [1, 1];} break; // was compProbs = [.2, 1];
      			case 1: compProbs = [1, 1]; break;
      			case 2: compProbs = [1, 1]; /*alert("folding 40 - 50 percentile");*/ break;						
      		}
      	}
      	else {
      		switch(numPlayerRaises[roundNum - 2]){
      			case 0: if(betRound == 0) {compProbs = [0, .5];} else { compProbs = [.8, 1];}  break; // was compProbs = [0, 1];
      			case 1: compProbs = [1, 1]; break;
      			case 2: compProbs = [1, 1]; /* alert("folding 40 - 50 percentile"); */ break;	
      		}
      	}
      }
      
      else if(percentile < 55) { 
      	compProbs = [0, .7]; 
      	if(button == 1) {
      		switch(numPlayerRaises[roundNum - 2]){
      			case 0: if(betRound == 0) {compProbs = [0, .5];} else { compProbs = [.5, 1];}  break; // was compProbs = [0, .5];
      			case 1: compProbs = [.5, 1]; break; // was [0, 1]
      			case 2: compProbs = [1, 1]; break;						
      		}
      	}
      	else {
      		switch(numPlayerRaises[roundNum - 2]){
      			case 0: if(betRound == 0) {compProbs = [0, .5];} else { compProbs = [.8, 1];}  break; // was compProbs = [0, .5];
      			case 1: compProbs = [.5, 1]; break; // was [0, 1]
      			case 2: compProbs = [1, 1]; break;	
      		}
      	}
      }
      	
      else if(percentile < 60) { 
      	compProbs = [0, .7]; 
      	if(button == 1) {
      		switch(numPlayerRaises[roundNum - 2]){
      			case 0: if(betRound == 0) {compProbs = [0, .5];} else { compProbs = [.4, 1];}  break; // was compProbs = [0, .5];
      			case 1: compProbs = [.5, 1]; break; // was [0, 1]
      			case 2: compProbs = [1, 1]; break;						
      		}
      	}
      	else {
      		switch(numPlayerRaises[roundNum - 2]){
      			case 0: if(betRound == 0) {compProbs = [0, .5];} else { compProbs = [.7, 1];}  break; // was compProbs = [0, .5];
      			case 1: compProbs = [.5, 1]; break; // was [0, 1]
      			case 2: compProbs = [1, 1]; break;	
      		}
      	}
      }
      
      else if(percentile < 70) { 
      	compProbs = [0, .6]; 
      	if(button == 1) {
      		switch(numPlayerRaises[roundNum - 2]){
      			case 0: compProbs = [0, .2]; break;
      			case 1: compProbs = [0, 1]; break;
      			case 2: compProbs = [0, 1]; break;						
      		}
      	}
      	else {
      		switch(numPlayerRaises[roundNum - 2]){
      			case 0: compProbs = [0, .2]; break;
      			case 1: compProbs = [0, 1]; break;
      			case 2: compProbs = [0, 1];	break;	
      		}
      	}
      }
      
      else if(percentile < 77) { 
      	compProbs = [0, .6]; 
      	if(button == 1) {
      		switch(numPlayerRaises[roundNum - 2]){
      			case 0: compProbs = [0, .2]; break;
      			case 1: compProbs = [0, 1]; break;
      			case 2: compProbs = [0, 1]; break;						
      		}
      	}
      	else {
      		switch(numPlayerRaises[roundNum - 2]){
      			case 0: compProbs = [0, .2]; break;
      			case 1: compProbs = [0, 1]; break;
      			case 2: compProbs = [0, 1];	break;
      		}
      	}
      }
      	
      else if(percentile < 82) { 
      	compProbs = [0, .5]; 
      	if(button == 1) {
      		switch(numPlayerRaises[roundNum - 2]){
      			case 0: compProbs = [0, .15]; break;
      			case 1: compProbs = [0, .7]; break;
      			case 2: compProbs = [0, 1];	break;						
      		}
      	}
      	else {
      		switch(numPlayerRaises[roundNum - 2]){
      			case 0: compProbs = [0, .15]; break;
      			case 1: compProbs = [0, .7]; break;
      			case 2: compProbs = [0, 1];	break;	
      		}
      	}
      }
      
      else if(percentile < 87) { 
      	compProbs = [0, .3]; 
      	if(button == 1) {
      		switch(numPlayerRaises[roundNum - 2]){
      			case 0: compProbs = [0, 0]; break;
      			case 1: compProbs = [0, .5]; break;
      			case 2: compProbs = [0, .8]; break;						
      		}
      	}
      	else {
      		switch(numPlayerRaises[roundNum - 2]){
      		case 0: compProbs = [0, 0]; break;
      		case 1: compProbs = [0, .5]; break;
      		case 2: compProbs = [0, .8]; break;						
      		}
      	}
      }
      
      else if(percentile < 94) { 
      	compProbs = [0, .3]; 
      	if(button == 1) {
      		switch(numPlayerRaises[roundNum - 2]){
      			case 0: compProbs = [0, 0]; break;
      			case 1: compProbs = [0, .4]; break;
      			case 2: compProbs = [0, .6]; break;						
      		}
      	}
      	else {
      		switch(numPlayerRaises[roundNum - 2]){
      			case 0: compProbs = [0, 0]; break;
      			case 1: compProbs = [0, .4]; break;
      			case 2: compProbs = [0, .6]; break;						
      		}						
      	}	
      }
      
      else { 
      	compProbs = [0, .2]; 
      	if(button == 1) {
      		switch(numPlayerRaises[roundNum - 2]){
      			case 0: compProbs = [0, 0]; break;
      			case 1: compProbs = [0, .2]; break;
      			case 2: compProbs = [0, .3]; break;							
      		}
      	}
      	else {
      		switch(numPlayerRaises[roundNum - 2]){
      			case 0: compProbs = [0, 0]; break;
      			case 1: compProbs = [0, .2]; break;
      			case 2: compProbs = [0, .3]; break;	
      		}
      	}
      }
      numPlayerRaises[0] = temp;		
      }
      
      function getCurCompCards(cards) {
      var num = roundNum + 2;
      for(var i = 0; i < num; i++) {
      	cards[i + 2] = allCards[i + 2];
      }
      return(cards);
      }
      
      function probAdjustment() {
      if (roundNum > 1) {generalCompProbs();}
      //if (roundNum >= 2 && roundNum <= 3) { getFutCompHandValue(); } ;
      if (pot >= 100 && percentile > 46) { compProbs[0] = 0; }
      if (pot >= 140 && percentile > 38) { compProbs[0] = 0; }						//never fold large pots
      if (pot >= 160 && percentile > 30) { compProbs[0] = 0; }
      if (pot >= 200) { compProbs[0] = 0; }	
      
      if (roundNum == 1) {
      	if (betRound > 2) {compProbs[0] = 0; }		//call to see flop if already raised pre
      	if (betRound >= 2 && pscore < 120) { compProbs[1] = 1; }		//should i clamp down pf
      	if (curCompBet >= 10 && button == 1) {compProbs[0] = 0; } //call if limped in				
      }				
      
      
      if (roundNum == 2){
      
      	if (percentile >= 60) { bluff = 0; }
      	
      	if (betRound == 0) {
      	
      		if (numCompRaises[0] == 2) { compProbs = [0, 0]; }	//always bet flop after 4 betting pf
      		if (lastRaise[0] == 1) {  compProbs = [0, 0]; } //always bet flop after 3 betting
      		
      		if (button == 1) {
      			if (lastRaise[0] == 0) {compProbs = [0, Math.min(.5, compProbs[1])];} //increase chance of raising flop when on button	when player has lead pf and checks flop						
      			if (bluff && Math.random() > .8) { compProbs = [0, 0]; } //	
      		}
      		
      		if (button == 0) {
      			if (percentile < 85 && Math.random() < .9 && lastRaise[0] == 0) { compProbs = [1, 1];} //check when first to act when player has lead
      			if (percentile >= 85 && Math.random() < .7 && lastRaise[0] == 0) { compProbs = [1, 1];} //keep checking to induce bets				
      			if (bluff && Math.random() > .8) { compProbs = [0, 0]; } //donk bluff	
      		}												
      	}
      	
      	if (betRound == 1){
      		if (button == 1) {							
      			if (percentile > 50 && Math.random() > .3) { compProbs = [0, 0]; }	//raise more with decent hands
      			if (bluff) { compProbs = [0, 0]; }
      			if (bluff && Math.random() < .2) { compProbs = [0, 1]; } //call to bluff the turn
      		}
      		if (button == 0) {
      			if (percentile > 70 && Math.random() > .4) { compProbs = [0, 0]; } //raising more with decent hands
      			if (bluff && Math.random() > .5) { compProbs = [0, 0]; } //bluff less often oop			
      		}				
      		if (overs && percentile > 35 && Math.random() > .4) { compProbs[0] = 0; } //sometimes call with overs
      	}
      	
      	if (betRound == 2){
      		if (button == 1) {						
      			if (percentile < 80) { compProbs[1] = 1; }	//slow down, do not 3 bet
      			if (bluff && Math.random() > .4) { compProbs = [0, 0]; }								
      		}
      		if (button == 0) {
      			if (percentile < 85) { compProbs[1] = 1; }	//slow down, do not 3 bet							
      			if (bluff && Math.random() > .5) { compProbs = [0, 0]; }		
      		}			
      		if (overs && percentile > 35 && Math.random() > .3) { compProbs[0] = 0; } //sometimes call with overs
      	}
      	
      	if (betRound == 3){
      		if (button == 1) {						
      			if (percentile < 80) { compProbs[1] = 1; }	//slow down, do not 3 bet
      			if (bluff && Math.random() > .4) { compProbs = [0, 0]; } //4-bet bluff							
      		}
      		if (button == 0) {
      			if (percentile < 85) { compProbs[1] = 1; }	//slow down, do not 3 bet							
      			if (bluff && Math.random() > .5) { compProbs = [0, 0]; } //4-bet bluff					
      		}			
      		if (overs && percentile > 35) { compProbs[0] = 0; } //call with overs					
      	}
      	
      	if (betRound == 4){						
      		if (bluff) { compProbs = [1, 1]; } //finally fold bluff	
      		if (percentile < 60) { compProbs = [1, 1]; }
      		if (overs) { compProbs[0] = 0; } //call with overs						
      	}								
      }
      
      if (roundNum == 3){
      	if (percentile >= 60) { bluff = 0; }
      	
      	if(betRound == 0) {
      		if (button == 1) { //comp has button
      			if (numCompRaises[1] == 2 && percentile > 96.5) { compProbs = [0, 0]; } //bet with monster
      			if (numCompRaises[1] <= 1 && pot <= 100) { compProbs = [0, Math.min(.5, compProbs[1])];  } //increase chance of betting with air
      			if (lastRaise[1] == 1) { compProbs = [0, 0]; } //always bet after having lead on flop on button
      			if (bluff == 0 && percentile < 60 &&  Math.random() < .4) { compProbs = [0, 1]; } // check behind occasionally with mediocre hands
      			if (bluff && lastRaise[1] == 1 && Math.random() < .8) { compProbs = [0, 0]; } // keep bluffing almost always
      		}
      		if (button == 0) { //player has button
      			if (percentile < 85 && Math.random() < .9 && lastRaise[1] == 0 && numCompRaises[1] < 2) { compProbs = [1, 1];} //check when first to act when player has lead
      			if (percentile >= 85 && Math.random() < .7 && lastRaise[1] == 0 && numCompRaises[1] < 2) { compProbs = [1, 1];} //keep checking to induce bets						
      			if (lastRaise[1] == 0 && percentile < 77) { compProbs = [1, 1]; } //check when player is in lead
      			if (compPerc[1] - compPerc[0] > 15 && lastRaise[1] == 0 && numPlayerRaises[1] > 0) { compProbs = [1, 1]; } //check-raise if backed into hand and player has lead
      			
      			if (lastRaise[1] == 1 && numPlayerRaises[1] <= 2 && percentile > 50) { compProbs = [0, 0]; } //always bet with lead oop with decent hand
      			//always bet with lead oop with decent hand
      			
      			if (bluff && lastRaise[1] == 1) { compProbs = [0, 0]; }
      		}					
      	}
      	
      	if(betRound == 1) {
      		if (percentile < 82) { compProbs[1] = 1; }	//slow down, do not raise
      		if (percentile < 86 && numPlayerRaises[1] == 1) { compProbs[1] = 1; } //never raise turn against strong player hand		
      		if (percentile < 89 && numPlayerRaises[1] == 2) { compProbs[1] = 1; } //never raise turn against strong player hand									
      	}
      	
      	if(betRound == 2) {
      		if (percentile < 92) { compProbs[1] = 1; }	//slow down, do not 3 bet
      		if(percentile < 94 && numPlayerRaises[1] == 2) { compProbs[1] = 1; } //slow down, don't three bet									
      	}			
      	
      	if (betRound == 3) {
      		if (percentile < 96.5) { compProbs[1] = 1; }	//slow down, do not 4 bet				
      		if(percentile < 97.5 && numPlayerRaises[1] == 2) { compProbs[1] = 1; } //slow down, don't 4 bet
      	}
      	
      	if (betRound == 4){
      		compProbs = [0, 1];
      	}					
      }				
      
      if (drawingHand && roundNum < 4) { compProbs[0] = 0; }
      
      if (roundNum == 4) { 
      	if(percentile > 94) { compProbs = [0,0]; } //raise all the way
      	
      	if(betRound == 0) {
      		if(bluff && lastRaise[2] == 1) { compProbs = [0, 0]; }
      		if(button == 0) {
      			if (percentile < 85 && Math.random() < 1 && lastRaise[2] == 0 && numCompRaises[2] < 2) { compProbs = [1, 1];} //check when first to act when player has lead
      			if (percentile >= 85 && Math.random() < .7 && lastRaise[2] == 0 && numCompRaises[2] < 2) { compProbs = [1, 1];} //keep checking to induce bets
      			if (compPerc[2] - compPerc[1] > 15 && lastRaise[2] == 0 && numPlayerRaises[2] > 0) { compProbs = [1, 1]; } //check-raise if backed into hand and player has lead							
      		}
      		if (button == 1) {						
      			if (percentile > 50 && numPlayerRaises[2] == 0) { compProbs = [0,0];} //make sure to bet if checked to on river
      			if (percentile > 66 && numPlayerRaises[2] == 1) { compProbs = [0,0];} //make sure to bet if checked to on river
      			if (percentile > 80 &&  numPlayerRaises[2] == 2) { compProbs = [0,0];} //make sure to bet if checked to on river					
      			if (lastRaise[2] == 1 && percentile > 55) { compProbs = [0,0]; }
      			if (pot <=80 && lastRaise[2] == -1 && Math.random() < .4 && percentile < 25) { compProbs = [0, 0]; }
      		}
      	}
      						
      	if (betRound == 1) {
      		if(percentile < 85) { compProbs[1] = 1; } //never raise river with weakish hand
      		if(percentile < 88 && numPlayerRaises[2] == 1) { compProbs[1] = 1; } //never raise river against strong player hand
      		if(percentile < 90 && numPlayerRaises[2] == 2) { compProbs[1] = 1; } //never raise river against strong player hand
      		if (percentile > 91 && numPlayerRaises[2] < 2) { compProbs = [0, 0]; } //make sure to raise
      	}
      	
      	if(betRound == 2){
      		if (percentile < 92) { compProbs[1] = 1; }	//slow down, do not 3 bet
      		if(percentile < 95 && numPlayerRaises[2] >= 1) { compProbs[1] = 1; } //slow down, don't three bet
      	}
      	
      	if (betRound == 3) {
      		if (percentile < 96.5) { compProbs[1] = 1; }	//slow down, do not 4 bet				
      		if(percentile < 98 && numPlayerRaises[2] >= 1) { compProbs[1] = 1; } //slow down, don't 4 bet
      	}
      	//maybe change above line based on lastraise				
      }
      }
      
      function findSlope(n) {
      var rect = totalPot.getBoundingClientRect();
      return([(rect.left - 200) / n, (rect.top - 20) / n]);
      }	
      
      function enterHand(potValue){
      var returnString = getPhpString(potValue);
      if (window.XMLHttpRequest) {// code for IE7+, Firefox, Chrome, Opera, Safari
      	xmlhttp=new XMLHttpRequest();
      }
      else{// code for IE6, IE5
      	xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
      }
      xmlhttp.onreadystatechange=function()
      	{
      		if (xmlhttp.readyState==4 && xmlhttp.status==200)
      		{
      			document.getElementById("phpReturn").innerHTML=xmlhttp.responseText;
      		}
      	}
      
      xmlhttp.open("GET","insertHH.php?q="+returnString,true);
      xmlhttp.send();
      }
      
      function getPhpString(potValue) {
      var returnString = "" + potValue +",";
      var showdown = 0;
      returnString = returnString + cardToString(allCards[7]) + "," + cardToString(allCards[8]) + ",";
      switch(roundNum) {
      	case 5:
      		returnString = returnString + cardToString(allCards[2]) + "," + cardToString(allCards[3]) + "," + cardToString(allCards[4]) + "," + cardToString(allCards[5]) + "," + cardToString(allCards[6]) + ",";
      		break;
      	case 4:
      		returnString = returnString + cardToString(allCards[2]) + "," + cardToString(allCards[3]) + "," + cardToString(allCards[4]) + "," + cardToString(allCards[5]) + "," + cardToString(allCards[6]) + ",";
      		break;
      	case 3:
      		returnString = returnString + cardToString(allCards[2]) + "," + cardToString(allCards[3]) + "," + cardToString(allCards[4]) + "," + cardToString(allCards[5]) + ",,";
      		break;
      	case 2:
      		returnString = returnString + cardToString(allCards[2]) + "," + cardToString(allCards[3]) + "," + cardToString(allCards[4]) + ",,," ;
      		break;
      	case 1:	
      		returnString = returnString + ",,,,,"
      }		
      
      if (curCompBet == curPlayerBet) {					
      	showdown = 1;
      }
      returnString = returnString + cardToString(allCards[0]) + "," + cardToString(allCards[1]) + ",";
      
      
      returnString = returnString + Math.abs(1 - button) + "," + Math.floor(percentile) + "," + showdown;
      //alert('fbName is ' + fbName + '   fbID is ' + fbID);
      
      for(var i = 0; i < 4; i++){
      	returnString = returnString + "," + numCompRaises[i] + "," + numPlayerRaises[i] + "," + lastRaise[i] + "," + betEachRound[i];
      }
      returnString += ',' + handNum + ',' + pscore + ',' + pscorePlayer + ',' + compPerc[0] + ',' + playerPerc[0]  + ',' + compPerc[1] + ',' + playerPerc[1]  + ',' + compPerc[2] + ',' + playerPerc[2] + ",'" + fbName + "'," + fbID + ',' + playerStartHandChips + ',' + 0;
      //add in preflop scores and percentiles
      return returnString;
      }
      
      function cardToString(cdNum) {
      var rankNum = cdNum % 13;
      var suitNum = Math.floor(cdNum / 13);
      var rankString = "";
      var suitString = "";
      
      switch(rankNum) {
      	case 9:
      		rankString = "T";
      		break;
      	case 10:
      		rankString = "J";
      		break;
      	case 11:
      		rankString = "Q";
      		break;
      	case 12:
      		rankString = "K";
      		break;
      	case 0:
      		rankString = "A";
      		break;
      	default:
      		rankString = "" + (rankNum + 1);
      }
      switch(suitNum){
      	case 0:
      		suitString = "c";
      		break;
      	case 1:
      		suitString = "s";
      		break;
      	case 2:
      		suitString = "h";
      		break;
      	case 3:
      		suitString = "d";
      		break;
      }
      
      return(rankString + suitString);
      }
      
      function cardToHtml(cd) {
      switch(cd[1]) {
      	case "c":
      	return(cd[0] + '&clubs;');
      		break;
      	case "s":
      		return(cd[0] + '&spades;');
      		break;
      	case "h":
      		return('<span style = "color:red">' + cd[0] + '&hearts;</span>');
      		break;
      	case "d":
      		return('<span style = "color:red">' + cd[0] + '&diams;</span>');
      		break;
      }
      }
      
      function congratPlayer() {
      if(compChips <= 0) {
      	alert("Congratulations!!! You beat the computer. Maybe you are good enough to play for real money.... ");
      	alert("Computer will now rebuy to 1000 chips");
      	compChips = 1000;
      }
      else {
      alert(".....Unfortunately the computer has taken all your chips. Keep playing to get better.");
      alert("You will now be back up to 1000 chips");
      playerChips = 1000;
      }
      }
      
      function handHistory() {
      var myWindow = window.open("","Hand History","width=500,height=500");
      myWindow.document.body.innerHTML = "";
      myWindow.document.write(lastHandMessage[0]);
      }
      
      
      Array.prototype.max = function(){
      return Math.max.apply(null, this);
      }
      
      Array.prototype.min = function(){
      return Math.min.apply(null, this);
      }
      
      window.onload = function() { 
      var id = document.getElementById("card2");
      id.style.width = "100%";
      id.style.height = "100%";	
      
      		
      //IE 8 updated function for array filter			
      if (!Array.prototype.filter)
      {
        Array.prototype.filter = function(fun /*, thisp */)
        {
          "use strict";
      
          if (this === void 0 || this === null)
            throw new TypeError();
      
          var t = Object(this);
          var len = t.length >>> 0;
          if (typeof fun !== "function")
            throw new TypeError();
      
          var res = [];
          var thisp = arguments[1];
          for (var i = 0; i < len; i++)
          {
            if (i in t)
            {
              var val = t[i]; // in case fun mutates this
              if (fun.call(thisp, val, i, t))
                res.push(val);
            }
          }
      
          return res;
        };
      }
      
      if (!Array.prototype.indexOf)
      {
        Array.prototype.indexOf = function(elt /*, from*/)
        {
          var len = this.length >>> 0;
      
          var from = Number(arguments[1]) || 0;
          from = (from < 0)
               ? Math.ceil(from)
               : Math.floor(from);
          if (from < 0)
            from += len;
      
          for (; from < len; from++)
          {
            if (from in this &&
                this[from] === elt)
              return from;
          }
          return -1;
        };
      }
      }		
      
        function getTotalHands(){
      if (window.XMLHttpRequest) {// code for IE7+, Firefox, Chrome, Opera, Safari
      	xmlhttp=new XMLHttpRequest();
      }
      else{// code for IE6, IE5
      	xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
      }
      xmlhttp.onreadystatechange=function(){
      	
      	if (xmlhttp.readyState==4 && xmlhttp.status==200){
      		var totalHands=xmlhttp.responseText;
      		document.getElementById('totalHandsPlayed').innerHTML = "GTOP Hand # " + totalHands;
      	}				
      }
      xmlhttp.open("GET","getTotalHands.php?q=",true);
      xmlhttp.send();					
      }
      
   </script>
</html>